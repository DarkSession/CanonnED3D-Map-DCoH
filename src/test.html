<!DOCTYPE html>
<html lang="en">

<head>
    <title>ED3DMap</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link type="text/css" rel="stylesheet" href="main.css">
    <style>
        body {
            font-family: 'Oxygen Mono', Tahoma, Arial, sans-serif, Helvetica, Sans-serif;
            background-color: #fff;
            color: #444;
            margin: 0;
        }

        a {
            color: #08f;
        }
    </style>
</head>

<body>
    <div id="container" style="width: 100vw; height: 100vh;"></div>

    <script src="bundle.js">
    </script>
    <script type="text/javascript">
        (async () => {
            const response = await fetch("https://dcoh.watch/api/v1/overwatch/systems?ngsw-bypass=true");
            if (response.status === 200) {
                const result = await response.json();

                const solSite = {
                    categories: ['00'],
                    name: "Sol",
                    description: "Cradle of Mankind<br>",
                    coordinates: {
                        x: 0,
                        y: 0,
                        z: 0,
                    }
                };

                const systems = [solSite];

                for (const data of result.systems) {
                    let description =
                        `<b>State</b>: ${data.thargoidLevel.name}<br>` +
                        `<b>Maelstrom</b>: ${data.maelstrom.name}<br>`;
                    if (data.progress) {
                        description += `<b>Progress</b>: ${data.progress} %<br>`;
                    }
                    if (data.thargoidLevel.level === 30) {
                        description +=
                            `<b>Stations Under Attack</b>: ${data.stationsUnderAttack}<br>` +
                            `<b>Stations Damaged</b>: ${data.stationsDamaged}<br>`;
                    }
                    else if (data.thargoidLevel.level === 70) {
                        description += `<b>Stations Under Repair</b>: ${data.stationsUnderRepair}<br>`;
                    }

                    if (data.stateExpiration?.stateExpires) {
                        // description += `<b>Time remaining</b>: ${timeAgo(data.stateExpiration.stateExpires)}<br>`;
                    }

                    const poiSite = {
                        name: data.name,
                        description: description,
                        categories: [data.thargoidLevel.level.toString()],
                        coordinates: data.coordinates,
                    }
                    systems.push(poiSite);
                }

                const ed3dMap = new ED3DMap.ED3DMap(document.getElementById("container"), {
                    showGalaxyInfos: true,
                    startAnimation: true,
                    systems: systems,
                    categories: {
                        "Systems": {
                            "00": {
                                name: "Sol",
                                color: "78b7f6",
                            },
                        },
                        "States": {
                            "20": {
                                name: "Alert",
                                color: "f1c232"
                            },
                            "30": {
                                name: "Invasion",
                                color: "ff5200"
                            },
                            "40": {
                                name: "Controlled",
                                color: "38761d"
                            },
                            "50": {
                                name: 'Maelstrom',
                                color: "cc0000"
                            },
                            "70": {
                                name: "Recovery",
                                color: "9f1bff"
                            }
                        },
                    },
                    withOptionsPanel: true,
                    withHudPanel: true,
                    showSystemSearch: true,
                });
                ed3dMap.start();
            }
        })();
    </script>
</body>

</html>